import{j as e,B as q,u as m,a as _,F as C,T as b,S as E,b as G,c as H,_ as K,d as Q,r as O,e as s,t as Z,I as J,f as V,g as X,L as Y}from"./signin-aa57d0a7.js";import{s as g,C as h,b as M,g as v,a as w,c as L}from"./utils-206316b5.js";function tt({size:t,scale:o=4}){return e.jsx(q,{width:t*o,height:t*o,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 197.091 197.091",children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{fill:"currentColor",d:`M32.131,184.928L32.131,184.928c-18.388,0-31.573-2.505-32.131-2.616l0.734-7.648
        c32.349,0,55.555-8.45,68.964-25.098c15.174-18.835,13.532-43.34,12.394-51.811H25.918l85.588-85.592l85.585,85.592h-53.976
        C136.315,173.487,70.922,184.928,32.131,184.928z M44.564,90.028h43.912l0.673,3.028c0.311,1.432,7.476,35.341-13.381,61.302
        c-8.425,10.475-20.113,18.041-34.94,22.651c42.867-1.882,90.753-18.714,94.861-83.362l0.229-3.618h42.527l-66.939-66.946
        L44.564,90.028z`})})})})})}const ot=m(C)`
  border: solid;
  background-color: ${({theme:t})=>{var o;return(o=t==null?void 0:t.colors)==null?void 0:o.secondary}};
  color: ${({theme:t})=>{var o;return(o=t==null?void 0:t.colors)==null?void 0:o.subtext}};
`,et=({message:t})=>e.jsxs(ot,{position:"absolute",top:0,right:0,justifyContent:"center",flexDirection:"row",border:"1px",padding:2,borderRadius:"4px",maxWidth:"280px",children:[t,e.jsx(_,{marginLeft:2,children:e.jsx(tt,{size:4})})]}),rt=m(C)`
  border: 1px solid;
  background-color: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.cardBg}};
  color: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.cardColor}};
`,at=m(_)`
  visibility: ${({visible:t})=>t?"visible":"hidden"};
`,it=({signin:t,requestId:o,rurl:r})=>{var i,c,n;const a=async()=>{const{data:p,error:d}=await g({type:h.authentication_get_signed_headers,data:{rurl:r,signin:t}});d?K.error(d.message):(P(),window.postMessage({type:"/signify/reply",requestId:o,payload:p},"*"))};return e.jsxs(rt,{flexDirection:"row",justifyContent:"space-between",padding:2,margin:2,alignItems:"start",borderRadius:"4px",borderColor:"black",children:[e.jsxs(_,{maxWidth:"180px",$breakWord:!0,children:[e.jsxs(b,{fontWeight:"bold",fontSize:1,textAlign:"start",$color:"heading",children:["URL:"," ",e.jsx(E,{fontWeight:"normal",$color:"text",children:t.domain})]}),t!=null&&t.identifier?e.jsxs(b,{textAlign:"start",fontSize:1,$color:"heading",children:[e.jsx("strong",{children:"AID: "})," ",e.jsx(E,{fontWeight:"normal",$color:"text",children:(i=t==null?void 0:t.identifier)==null?void 0:i.name})]}):e.jsx(e.Fragment,{}),t!=null&&t.credential?e.jsxs(b,{fontWeight:"normal",textAlign:"start",fontSize:1,$color:"heading",children:[e.jsx("strong",{children:"Cred: "})," ",e.jsx(E,{fontWeight:"normal",$color:"text",children:(n=(c=t==null?void 0:t.credential)==null?void 0:c.schema)==null?void 0:n.title})]}):e.jsx(e.Fragment,{}),e.jsxs(b,{fontWeight:"bold",textAlign:"start",fontSize:0,$color:"heading",children:["Last used:"," ",e.jsx(E,{fontWeight:"normal",$color:"text",children:new Date(t.updatedAt).toDateString()})]})]}),e.jsxs(C,{flexDirection:"column",$flexGap:2,children:[e.jsxs(at,{visible:t==null?void 0:t.autoSignin,children:[e.jsx(b,{$color:"",textAlign:"end",fontSize:"8px",fontWeight:"bold",children:"Auto Sign in"}),e.jsx(_,{$float:"right",children:e.jsx(G,{size:6})})]}),e.jsx(H,{handleClick:a,children:e.jsx(e.Fragment,{children:"Sign in"})})]})]})},st=m(_)`
  border: ${t=>{var o,r,a,i;return`1px solid ${((r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.bodyBorder)??((i=(a=t.theme)==null?void 0:a.colors)==null?void 0:i.bodyBg)}`}};
  background: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.bodyBg}};
  color: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.bodyColor}};
`,dt=m(V)`
  position: absolute;
  top: 24px;
  left: 0px;
  font-size: 12px;
  padding: 4px 8px;
  text-align: center;
  border-radius: 50%;
  background: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.bodyBg}};
  color: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.bodyColor}};
  &:hover {
    background-color: #f55877;
    color: white;
  }
  border: ${t=>{var o,r,a,i;return`1px solid ${((r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.bodyBorder)??((i=(a=t.theme)==null?void 0:a.colors)==null?void 0:i.bodyBg)}`}};
`,B=m.span`
  display: inline-block;
`,A=m.img`
  height: ${({height:t})=>t};
`,W=m(C)`
  border: 1px solid;
  padding: 8px;
  margin-bottom: 4px;
  overflow-wrap: anywhere;
  background-color: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.cardBg}};
  color: ${t=>{var o,r;return(r=(o=t.theme)==null?void 0:o.colors)==null?void 0:r.cardColor}};
`;function ct({isConnected:t=!1,vendorData:o,tabUrl:r="",signins:a=[],autoSigninObjExists:i,eventType:c=s.NONE,handleRemove:n,requestId:p,rurl:d}){const{formatMessage:l}=Q(),u=(o==null?void 0:o.logo)??M.runtime.getURL("src/assets/img/128_keri_logo.png"),[I,f]=O.useState(!1),T=!(a!=null&&a.length)||!i&&c===s.SELECT_AUTO_SIGNIN||!t,N=()=>{f(!0)};O.useEffect(()=>{R(c),T&&f(!0)},[]);const $=()=>{n()},S=()=>{switch(c){case s.SELECT_CREDENTIAL:return"credential.title";case s.SELECT_ID_CRED:return"signin.aidOrCredential";case s.SELECT_AUTO_SIGNIN:return"signin.autoSignin";default:return"identifier.title"}};return e.jsxs(Z,{theme:o==null?void 0:o.theme,children:[e.jsx(J,{position:"bottom-right",toastOptions:{style:{borderRadius:"10px",background:"#333",color:"#fff"}}}),e.jsxs(_,{position:"absolute",width:"320px",maxHeight:"540px",paddingTop:4,top:"40px",right:"40px",overflow:"auto",children:[I?e.jsx(et,{message:e.jsxs(b,{fontSize:1,$color:"subtext",children:[l({id:"action.open"})," ",e.jsx(B,{children:e.jsx(A,{src:u,height:"16px",alt:"logo"})})," ",l({id:"action.toProceed"})]})}):null,e.jsx(dt,{type:"button",onClick:$,children:"x"}),e.jsxs(st,{borderRadius:"4px",textAlign:"center",padding:3,children:[e.jsxs(C,{flexDirection:"row",$flexGap:2,alignItems:"center",children:[e.jsx(A,{src:u,height:"32px",alt:"logo"}),e.jsxs(b,{fontWeight:"bold",fontSize:3,$color:"bodyColor",children:[l({id:"signin.with"})," ",o==null?void 0:o.title]})]}),T?e.jsxs(_,{marginTop:2,maxWidth:"280px",children:[e.jsxs(W,{justifyContent:"center",children:[e.jsx(b,{$color:"",children:v(r)})," "]}),e.jsxs(b,{fontSize:1,fontWeight:"bold",$color:"bodyColor",children:[l({id:"signin.requestAuth"})," ",l({id:S()})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{marginTop:2,children:e.jsx(W,{padding:1,children:e.jsx(E,{fontSize:0,fontWeight:"bold",$color:"bodyColor",children:l({id:"signin.disclaimer"})})})}),a==null?void 0:a.map(j=>e.jsx(it,{rurl:d,signin:j,requestId:p})),c!==s.NONE?e.jsxs(_,{onClick:N,fontWeight:"bold",fontSize:1,$cursorPointer:!0,children:[l({id:"action.click"})," ",e.jsx(B,{children:e.jsx(A,{height:"16px",src:u,alt:"logo"})})," ",l({id:"action.toSelectOther"})," ",l({id:S()})]}):e.jsx(e.Fragment,{})]})]})]})]})}var k=s.NONE;let y="",x="";window.postMessage({type:"signify-extension",data:{extensionId:w()}},"*");window.addEventListener("message",async t=>{var o,r,a,i,c,n,p,d,l;if(t.source===window&&(console.log("Content script received from web page: "+t.data.type),t.data.type))switch(t.data.type){case s.SELECT_IDENTIFIER:case s.SELECT_CREDENTIAL:case s.SELECT_ID_CRED:case s.SELECT_AUTO_SIGNIN:await g({type:h.action_icon_set_tab});const u=await g({type:h.vendor_info_get_vendor_data}),{data:I}=await g({type:h.authentication_check_agent_connection}),f=await g({type:h.fetch_resource_tab_signin}),T=D((o=f==null?void 0:f.data)==null?void 0:o.signins,t.data.type,t.data.schema);y=((r=t==null?void 0:t.data)==null?void 0:r.requestId)??"",x=((a=t==null?void 0:t.data)==null?void 0:a.rurl)??x,U(I.isConnected,I.tabUrl,T,t.data.type,(i=f==null?void 0:f.data)==null?void 0:i.autoSigninObj,(c=u==null?void 0:u.data)==null?void 0:c.vendorData,y,x);break;case s.CONFIGURE_VENDOR:await g({type:h.action_icon_set}),await L(w(),{type:h.vendor_info_provide_config_url,data:{vendorUrl:t.data.payload.url}});break;case s.AUTHORIZE_AUTO_SIGNIN:const{data:N,error:$}=await L(w(),{type:h.fetch_resource_auto_signin_signature,data:{}});y=((n=t==null?void 0:t.data)==null?void 0:n.requestId)??"",x=((p=t==null?void 0:t.data)==null?void 0:p.rurl)??x,$?$.code===404&&window.postMessage({type:"select-auto-signin",requestId:y,rurl:x},"*"):window.postMessage({type:"/signify/reply",payload:N,requestId:y,rurl:x},"*");break;case s.SIGN_REQUEST:const{data:S,error:j}=await L(w(),{type:h.fetch_resource_signed_headers,data:t.data.payload});y=((d=t==null?void 0:t.data)==null?void 0:d.requestId)??"",x=((l=t==null?void 0:t.data)==null?void 0:l.rurl)??x,console.log("signedHeaders",S),j?window.postMessage({type:"/signify/reply",error:j==null?void 0:j.message,requestId:y,rurl:x},"*"):window.postMessage({type:"/signify/reply",payload:S,requestId:y,rurl:x},"*");break}},!1);M.runtime.onMessage.addListener(async function(t,o,r){var a,i,c;if(o.id===w()){if(console.log("Content script received message from browser extension: "+t.type+":"+t.subtype),t.type==="tab"&&t.subtype==="reload-state"&&z()!==s.NONE){F();const n=await g({type:h.vendor_info_get_vendor_data}),{data:p}=await g({type:h.authentication_check_agent_connection}),d=await g({type:h.fetch_resource_tab_signin}),l=D((a=d==null?void 0:d.data)==null?void 0:a.signins,t.eventType,t.schema);U(p.isConnected,p.tabUrl,l,t.eventType??"",(i=d==null?void 0:d.data)==null?void 0:i.autoSigninObj,(c=n==null?void 0:n.data)==null?void 0:c.vendorData,y,x)}if(t.type==="tab"&&t.subtype==="get-tab-state")return Promise.resolve({data:{tabState:z()}});t.type==="tab"&&t.subtype==="set-tab-state"&&R(t.data.tabState)}});function U(t,o,r,a,i,c,n,p){let d=document.querySelector("#__root");if(!d){const u=document.createElement("div");u.id="__root",document.body.appendChild(u),d=document.querySelector("#__root")}X(d).render(e.jsx(Y,{children:e.jsx(ct,{isConnected:t,vendorData:c,tabUrl:o,signins:r,autoSigninObjExists:!!i,eventType:a,handleRemove:P,requestId:n,rurl:p})}))}function F(){const t=document.getElementById("__root");t&&t.remove(),g({type:h.action_icon_unset_tab})}function P(){F(),R(s.NONE)}function D(t,o,r){let a=[];return t!=null&&t.length?(t.forEach(i=>{i.identifier&&(o===s.SELECT_IDENTIFIER||o===s.SELECT_ID_CRED)&&a.push(i),i.credential&&(o===s.SELECT_CREDENTIAL||o===s.SELECT_ID_CRED)&&(!r||i.credential.schema.id===r)&&a.push(i)}),a):[]}function R(t){console.log("setTabState: "+t),k=t}function z(){return console.log("getTabState: "+k),k}export{z as getTabState,P as resetTabState,R as setTabState};
